name: Update Splash Image
author: Bert Pluymers
description: Generate updated Splash image with appropriate package version.

inputs:
    uv_version:
        required: true
        description: "Version of UV to be used."
    github_token:
        required: true
        description: "Github token to be used to upload to github pages"


runs:
    using: "composite"
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: '${{ inputs.github_token }}'
          ref: ${{ github.ref }} # check out the triggering ref

      - name: Install uv
        uses: astral-sh/setup-uv@v7
        with:
          version: ${{ inputs.uv_version }}

      - name: Determine Build Type
        id: build_type
        uses: ./.github/actions/build_type

      - name: Install ImageMagick 7
        uses: mfinelli/setup-imagemagick@v7

      - name: Determine Package version
        shell: bash
        run: |
            PACKAGE_VERSION=$(uv version --short)
            if [[ "${{ steps.build_type.outputs.build_type }}" == "develop" ]]; then
              DISPLAY_VERSION="v${PACKAGE_VERSION}-dev"
            else
              DISPLAY_VERSION="v${PACKAGE_VERSION}"
            fi
            echo "DISPLAY_VERSION=$DISPLAY_VERSION" >> $GITHUB_ENV  

      - name: Prepare splash screen
        shell: bash
        run: |
            ./.github/scripts/create_splash.sh "${DISPLAY_VERSION}"
            mkdir -p "./splash"
            cp "./images/splash_with_version.webp" "./splash/splash.webp"           

      - name: Pass splash to next action
        uses: actions/upload-artifact@v4
        with:
          name: splash
          path: ./splash/